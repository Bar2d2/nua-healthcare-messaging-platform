<div class="list-group-item list-group-item-action d-flex gap-3 py-3" id="<%= dom_id(message) %>">
  <div class="d-flex gap-2 w-100 justify-content-between">
    <div>
      <h6 class="mb-1">
        <% if message.outbox.user.is_doctor? %>Dr.<% end %>
        <%= message.outbox.user.full_name %>
        <% if message.outbox.user == User.current %>
          <small class="text-muted"><%= t('common.you') %></small>
        <% end %>
      </h6>
      <div class="mb-0"><%= simple_format(message.body, {}, { sanitize: true }) %></div>
    </div>
    <div class="text-end">
      <small class="text-muted text-nowrap d-block">
        <%= time_ago_in_words(message.created_at) %> ago
      </small>

      <!-- Admin Prescription Status Badge Only -->
      <% if current_user.is_admin? && prescription_request_message?(message) %>
        <% prescription = find_prescription_from_message(message) %>
        <% if prescription %>
          <div id="prescription-badge-<%= prescription.id %>">
            <%= render 'messages/partials/conversation/prescription_badge', prescription: prescription %>
          </div>
        <% end %>
      <% end %>

      <!-- Regular Message Status -->
      <% if message.outbox.user == User.current %>
        <small class="text-muted d-block mt-1">
          <span class="badge bg-primary"><%= t('messages.partials.list.sent_message_item.sent') %></span>
        </small>
      <% else %>
        <small class="text-muted d-block mt-1">
          <span class="badge bg-secondary"><%= t('messages.partials.list.received_message_item.received_message') %></span>
        </small>
      <% end %>
    </div>
  </div>
</div>
